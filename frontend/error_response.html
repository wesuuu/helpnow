
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <title>Error</title>
            <script type="module">
              const error = {"message":"Error while preprocessing /home/wesuuu/Code/helpnow/frontend/src/pages/ContentTemplates.svelte - [postcss] /home/wesuuu/Code/helpnow/frontend/src/pages/ContentTemplates.svelte.vite-preprocess.css:1:3: Unknown word styles","stack":"    at Input.error (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/input.js:135:16)\n    at Parser.unknownWord (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/parser.js:595:22)\n    at Parser.other (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/parser.js:437:12)\n    at Parser.parse (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/parser.js:472:16)\n    at parse (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/parse.js:11:12)\n    at new LazyResult (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/lazy-result.js:165:16)\n    at Processor.process (/home/wesuuu/Code/helpnow/frontend/node_modules/postcss/lib/processor.js:53:14)\n    at runPostCSS (file:///home/wesuuu/Code/helpnow/frontend/node_modules/vite/dist/node/chunks/config.js:30144:68)\n    at async compilePostCSS (file:///home/wesuuu/Code/helpnow/frontend/node_modules/vite/dist/node/chunks/config.js:30128:6)\n    at async compileCSS (file:///home/wesuuu/Code/helpnow/frontend/node_modules/vite/dist/node/chunks/config.js:30058:26)","id":"/home/wesuuu/Code/helpnow/frontend/src/pages/ContentTemplates.svelte","frame":"","plugin":"vite-plugin-svelte:preprocess","pluginCode":"\u003cscript lang=\"ts\">\n    import { onMount, onDestroy } from \"svelte\";\n    import TemplateEditor from \"../lib/components/TemplateEditor.svelte\";\n    // import StudioEditor from \"../lib/components/StudioEditor.svelte\";\n    import { toast } from \"../lib/stores/toast\";\n    import { router } from \"../lib/router.svelte.js\";\n\n    type Template = {\n        id: number;\n        organization_id: number;\n        name: string;\n        type: string;\n        content: string; // HTML content\n        schema: string; // JSON schema string\n        created_at: string;\n    };\n\n    const DEFAULTS: Record\u003cstring, string> = {\n        AD: `\u003cdiv style=\"text-align: center; padding: 20px; border: 1px solid #ccc; max-width: 300px; margin: auto;\">\n    \u003ch2 style=\"color: #333;\">Special Offer!\u003c/h2>\n    \u003cp style=\"color: #666;\">Get 50% off on your first purchase.\u003c/p>\n    \u003ca href=\"#\" style=\"background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; display: inline-block; border-radius: 5px;\">Shop Now\u003c/a>\n\u003c/div>`,\n        FORM: `\u003cform style=\"max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px;\">\n    \u003cdiv style=\"margin-bottom: 15px;\">\n        \u003clabel style=\"display: block; margin-bottom: 5px; font-weight: bold;\">Name\u003c/label>\n        \u003cinput type=\"text\" placeholder=\"John Doe\" style=\"width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;\" />\n    \u003c/div>\n    \u003cdiv style=\"margin-bottom: 15px;\">\n        \u003clabel style=\"display: block; margin-bottom: 5px; font-weight: bold;\">Email\u003c/label>\n        \u003cinput type=\"email\" placeholder=\"john@example.com\" style=\"width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;\" />\n    \u003c/div>\n    \u003cbutton type=\"submit\" style=\"width: 100%; background-color: #28a745; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;\">Subscribe\u003c/button>\n\u003c/form>`,\n        LANDING_PAGE: `\u003cdiv style=\"font-family: Arial, sans-serif;\">\n    \u003cheader style=\"background-color: #f8f9fa; padding: 40px 20px; text-align: center;\">\n        \u003ch1 style=\"color: #333; font-size: 2.5em;\">Welcome to Our Service\u003c/h1>\n        \u003cp style=\"color: #666; font-size: 1.2em;\">We provide the best solutions for your business.\u003c/p>\n        \u003ca href=\"#contact\" style=\"background-color: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 20px;\">Get Started\u003c/a>\n    \u003c/header>\n    \u003csection style=\"padding: 40px 20px; max-width: 800px; margin: auto; display: flex; justify-content: space-around;\">\n        \u003cdiv style=\"text-align: center; max-width: 30%;\">\n            \u003ch3>Feature 1\u003c/h3>\n            \u003cp>Description of feature 1.\u003c/p>\n        \u003c/div>\n        \u003cdiv style=\"text-align: center; max-width: 30%;\">\n            \u003ch3>Feature 2\u003c/h3>\n            \u003cp>Description of feature 2.\u003c/p>\n        \u003c/div>\n        \u003cdiv style=\"text-align: center; max-width: 30%;\">\n            \u003ch3>Feature 3\u003c/h3>\n            \u003cp>Description of feature 3.\u003c/p>\n        \u003c/div>\n    \u003c/section>\n\u003c/div>`,\n        EMAIL: `\u003ctable width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"font-family: sans-serif;\">\n    \u003ctr>\n        \u003ctd align=\"center\" style=\"padding: 20px; background-color: #f6f6f6;\">\n            \u003ctable width=\"600\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: #ffffff; border-radius: 4px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n                \u003ctr>\n                    \u003ctd style=\"padding: 30px; text-align: center;\">\n                        \u003ch2 style=\"margin: 0; color: #333333;\">Welcome Aboard!\u003c/h2>\n                        \u003cp style=\"color: #666666; line-height: 1.5;\">Thank you for joining us. We are excited to have you on board.\u003c/p>\n                        \u003ca href=\"#\" style=\"display: inline-block; margin-top: 20px; background-color: #007bff; color: #ffffff; padding: 10px 20px; text-decoration: none; border-radius: 4px;\">Verify Email\u003c/a>\n                    \u003c/td>\n                \u003c/tr>\n                \u003ctr>\n                    \u003ctd style=\"background-color: #eeeeee; padding: 10px; text-align: center; font-size: 12px; color: #999999;\">\n                        &copy; 2024 HelpNow. All rights reserved.\n                    \u003c/td>\n                \u003c/tr>\n            \u003c/table>\n        \u003c/td>\n    \u003c/tr>\n\u003c/table>`,\n    };\n\n    let templates: Template[] = [];\n    let loading = true;\n    let editingTemplate: Template | null = null;\n    let isCreating = false;\n    let editorMode: \"visual\" | \"studio\" | \"code\" = \"visual\";\n    let showPreview = false;\n    let isDirty = false;\n    let visualEditor: any;\n\n    // Form bind variables\n    let formName = \"\";\n    let formType = \"AD\";\n\n    async function fetchTemplates() {\n        loading = true;\n        try {\n            // Hardcoding org_id=1 for now as per previous context/pattern or we should get from auth\n            const res = await fetch(\"/api/templates?organization_id=1\");\n            if (res.ok) {\n                templates = await res.json();\n            } else {\n                toast.error(\"Failed to load templates\");\n            }\n        } catch (e) {\n            toast.error(\"Error loading templates\");\n        } finally {\n            loading = false;\n        }\n    }\n\n    async function saveTemplate() {\n        if (!editingTemplate) return;\n\n        try {\n            const url = isCreating\n                ? \"/api/templates\"\n                : `/api/templates/${editingTemplate.id}`;\n            const method = isCreating ? \"POST\" : \"PUT\";\n\n            // For creating, we need org_id. For updating, we generally act on the resource\n            const payload = {\n                organization_id: 1, // hardcoded for now\n                name: editingTemplate.name,\n                type: editingTemplate.type,\n                content: editingTemplate.content,\n                schema: editingTemplate.schema || \"{}\",\n            };\n\n            const res = await fetch(url, {\n                method,\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(payload),\n            });\n\n            if (res.ok) {\n                toast.success(\"Template saved successfully\");\n                editingTemplate = null;\n                isCreating = false;\n                setDirty(false);\n                fetchTemplates();\n            } else {\n                toast.error(\"Failed to save template\");\n            }\n        } catch (e) {\n            toast.error(\"Error saving template\");\n        }\n    }\n\n    function startCreate() {\n        editingTemplate = {\n            id: 0,\n            organization_id: 1,\n            name: \"New Template\",\n            type: \"AD\",\n            content: DEFAULTS[\"AD\"],\n            schema: \"{}\",\n            created_at: \"\",\n        };\n        isCreating = true;\n        editorMode = \"visual\";\n        setDirty(false);\n    }\n\n    function startEdit(t: Template) {\n        if (isDirty) {\n            if (\n                !confirm(\n                    \"You have unsaved changes. Are you sure you want to discard them?\",\n                )\n            ) {\n                return;\n            }\n        }\n        // Clone to avoid mutating list directly\n        editingTemplate = { ...t };\n        isCreating = false;\n        editorMode = \"visual\";\n        setDirty(false);\n    }\n\n    function cancelEdit() {\n        if (isDirty) {\n            if (\n                !confirm(\n                    \"You have unsaved changes. Are you sure you want to discard them?\",\n                )\n            ) {\n                return;\n            }\n        }\n        editingTemplate = null;\n        isCreating = false;\n        setDirty(false);\n    }\n\n    function setDirty(dirty: boolean) {\n        isDirty = dirty;\n        if (isDirty) {\n            router.registerGuard(() => {\n                return confirm(\n                    \"You have unsaved changes. Are you sure you want to leave?\",\n                );\n            });\n        } else {\n            router.unregisterGuard();\n        }\n    }\n\n    function handleTypeChange() {\n        if (!editingTemplate) return;\n        if (DEFAULTS[editingTemplate.type]) {\n            const newContent = DEFAULTS[editingTemplate.type];\n            editingTemplate.content = newContent;\n\n            // Update editor explicitly if active\n            if (editorMode === \"visual\" && visualEditor) {\n                // @ts-ignore\n                visualEditor.setContent(newContent);\n            }\n            // Mark as dirty because content changed\n            setDirty(true);\n        }\n    }\n\n    function handleEditorChange(html: string, styles: string) {\n        if (editingTemplate && editorMode === \"visual\") {\n            try {\n                // Combine HTML and CSS for storage and preview\n                const cssBlock = styles ? `\u003cstyle>${styles}\u003c/style>` : \"\";\n                editingTemplate.content = html + cssBlock;\n                setDirty(true);\n            } catch (e) {\n                console.error(\"Error updating editor content:\", e);\n            }\n        }\n    }\n\n    onDestroy(() => {\n        router.unregisterGuard();\n    });\n\n    onMount(() => {\n        fetchTemplates();\n    });\n\u003c/script>\n\n\u003csvelte:window\n    on:beforeunload={(e) => {\n        if (isDirty && editingTemplate) {\n            e.preventDefault();\n            e.returnValue = \"\";\n        }\n    }}\n/>\n\n\u003cdiv class=\"space-y-6 h-full flex flex-col\">\n    {#if !editingTemplate}\n        \u003cdiv class=\"flex justify-between items-center\">\n            \u003ch1 class=\"text-2xl font-semibold text-gray-900 dark:text-white\">\n                Content Templates\n            \u003c/h1>\n            \u003cbutton\n                class=\"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\"\n                onclick={startCreate}>Create Template\u003c/button\n            >\n        \u003c/div>\n\n        {#if loading}\n            \u003cdiv class=\"text-center py-4\">Loading...\u003c/div>\n        {:else if templates.length === 0}\n            \u003cdiv\n                class=\"text-center py-10 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n            >\n                \u003cp class=\"text-gray-500\">\n                    No templates found. Create one to get started.\n                \u003c/p>\n            \u003c/div>\n        {:else}\n            \u003cdiv\n                class=\"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden\"\n            >\n                \u003ctable\n                    class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\"\n                >\n                    \u003cthead class=\"bg-gray-50 dark:bg-gray-700\">\n                        \u003ctr>\n                            \u003cth\n                                class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\"\n                                >Name\u003c/th\n                            >\n                            \u003cth\n                                class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\"\n                                >Type\u003c/th\n                            >\n                            \u003cth\n                                class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\"\n                                >Created\u003c/th\n                            >\n                            \u003cth\n                                class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\"\n                                >Actions\u003c/th\n                            >\n                        \u003c/tr>\n                    \u003c/thead>\n                    \u003ctbody\n                        class=\"divide-y divide-gray-200 dark:divide-gray-700\"\n                    >\n                        {#each templates as t}\n                            \u003ctr\n                                class=\"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer\"\n                                onclick={() => startEdit(t)}\n                            >\n                                \u003ctd\n                                    class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\"\n                                    >{t.name}\u003c/td\n                                >\n                                \u003ctd\n                                    class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\"\n                                    >{t.type}\u003c/td\n                                >\n                                \u003ctd\n                                    class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\"\n                                    >{new Date(\n                                        t.created_at,\n                                    ).toLocaleDateString()}\u003c/td\n                                >\n                                \u003ctd\n                                    class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\"\n                                >\n                                    \u003cbutton\n                                        class=\"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300\"\n                                        >Edit\u003c/button\n                                    >\n                                \u003c/td>\n                            \u003c/tr>\n                        {/each}\n                    \u003c/tbody>\n                \u003c/table>\n            \u003c/div>\n        {/if}\n    {:else}\n        \u003c!-- Editor Mode -->\n        \u003cdiv class=\"flex flex-col h-full relative\">\n            \u003cdiv\n                class=\"flex justify-between items-center mb-4 bg-white dark:bg-gray-800 p-2 rounded shadow-sm\"\n            >\n                \u003cdiv class=\"flex items-center space-x-4\">\n                    \u003cinput\n                        type=\"text\"\n                        bind:value={editingTemplate.name}\n                        class=\"px-3 py-2 border rounded text-lg font-medium text-gray-900 dark:bg-gray-700 dark:text-white dark:border-gray-600\"\n                    />\n                    \u003cselect\n                        bind:value={editingTemplate.type}\n                        onchange={handleTypeChange}\n                        class=\"px-3 py-2 border rounded text-sm text-gray-900 dark:bg-gray-700 dark:text-white dark:border-gray-600\"\n                    >\n                        \u003coption value=\"AD\">Ad\u003c/option>\n                        \u003coption value=\"FORM\">Form\u003c/option>\n                        \u003coption value=\"LANDING_PAGE\">Landing Page\u003c/option>\n                        \u003coption value=\"EMAIL\">Email\u003c/option>\n                    \u003c/select>\n                \u003c/div>\n\n                \u003c!-- Toolbar -->\n                \u003cdiv class=\"flex items-center space-x-2\">\n                    \u003cdiv\n                        class=\"bg-gray-100 dark:bg-gray-700 rounded p-1 flex mr-4\"\n                    >\n                        \u003cbutton\n                            class=\"px-3 py-1 rounded text-sm {editorMode ===\n                            'visual'\n                                ? 'bg-white shadow dark:bg-gray-600 dark:text-white'\n                                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400'}\"\n                            onclick={() => (editorMode = \"visual\")}\n                            >Visual\u003c/button\n                        >\n                        \u003cbutton\n                            class=\"px-3 py-1 rounded text-sm {editorMode ===\n                            'code'\n                                ? 'bg-white shadow dark:bg-gray-600 dark:text-white'\n                                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400'}\"\n                            onclick={() => (editorMode = \"code\")}>Code\u003c/button\n                        >\n                    \u003c/div>\n\n                    \u003cbutton\n                        class=\"px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700\"\n                        onclick={() => (showPreview = true)}>Preview\u003c/button\n                    >\n\n                    \u003cbutton\n                        class=\"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300\"\n                        onclick={cancelEdit}>Cancel\u003c/button\n                    >\n                    \u003cbutton\n                        class=\"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\"\n                        onclick={saveTemplate}>Save\u003c/button\n                    >\n                \u003c/div>\n            \u003c/div>\n\n            \u003c!-- Content Area -->\n            \u003cdiv\n                class=\"flex-1 border rounded relative overflow-hidden\"\n                style=\"min-height: 600px;\"\n            >\n                {#if editorMode === \"visual\"}\n                    \u003cTemplateEditor\n                        bind:this={visualEditor}\n                        content={editingTemplate.content}\n                        onChange={handleEditorChange}\n                    />\n                    \u003cdiv\n                        class=\"md:hidden p-4 bg-yellow-50 text-yellow-800 rounded absolute bottom-0 w-full text-center opacity-75\"\n                    >\n                        Editor is optimized for desktop view.\n                    \u003c/div>\n                {:else}\n                    \u003ctextarea\n                        class=\"w-full h-full p-4 font-mono text-sm bg-gray-50 dark:bg-gray-900 dark:text-gray-100 resize-none focus:outline-none\"\n                        bind:value={editingTemplate.content}\n                    >\u003c/textarea>\n                {/if}\n            \u003c/div>\n\n            \u003c!-- Preview Modal -->\n            {#if showPreview}\n                \u003cdiv\n                    class=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4\"\n                >\n                    \u003cdiv\n                        class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl h-[80vh] flex flex-col\"\n                    >\n                        \u003cdiv\n                            class=\"flex justify-between items-center p-4 border-b dark:border-gray-700\"\n                        >\n                            \u003ch3\n                                class=\"text-lg font-medium text-gray-900 dark:text-white\"\n                            >\n                                Preview\n                            \u003c/h3>\n                            \u003cbutton\n                                class=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n                                onclick={() => (showPreview = false)}\n                            >\n                                \u003csvg\n                                    xmlns=\"http://www.w3.org/2000/svg\"\n                                    class=\"h-6 w-6\"\n                                    fill=\"none\"\n                                    viewBox=\"0 0 24 24\"\n                                    stroke=\"currentColor\"\n                                >\n                                    \u003cpath\n                                        stroke-linecap=\"round\"\n                                        stroke-linejoin=\"round\"\n                                        stroke-width=\"2\"\n                                        d=\"M6 18L18 6M6 6l12 12\"\n                                    />\n                                \u003c/svg>\n                            \u003c/button>\n                        \u003c/div>\n                        \u003cdiv class=\"flex-1 bg-gray-100 p-4 overflow-auto\">\n                            \u003cdiv\n                                class=\"bg-white shadow mx-auto\"\n                                style=\"min-height: 100%;\"\n                            >\n                                \u003ciframe\n                                    srcdoc={editingTemplate.content}\n                                    title=\"Preview\"\n                                    class=\"w-full h-full border-none\"\n                                    style=\"min-height: 500px;\"\n                                >\u003c/iframe>\n                            \u003c/div>\n                        \u003c/div>\n                    \u003c/div>\n                \u003c/div>\n            {/if}\n        \u003c/div>\n    {/if}\n\u003c/div>\n"}
              try {
                const { ErrorOverlay } = await import("/@vite/client")
                document.body.appendChild(new ErrorOverlay(error))
              } catch {
                const h = (tag, text) => {
                  const el = document.createElement(tag)
                  el.textContent = text
                  return el
                }
                document.body.appendChild(h('h1', 'Internal Server Error'))
                document.body.appendChild(h('h2', error.message))
                document.body.appendChild(h('pre', error.stack))
                document.body.appendChild(h('p', '(Error overlay failed to load)'))
              }
            </script>
          </head>
          <body>
          </body>
        </html>
      